# Excel 고급 수식 가이드

## XLOOKUP 완전 가이드
- 구문: `=XLOOKUP(검색값, 검색범위, 반환범위, [없을때값], [일치모드], [검색모드])`
- 일치모드: `0` 정확히 일치(기본), `-1` 정확히 일치 또는 다음으로 작은 값, `1` 정확히 일치 또는 다음으로 큰 값, `2` 와일드카드 일치
- 검색모드: `1` 처음부터(기본), `-1` 끝에서부터, `2` 오름차순 이진 검색, `-2` 내림차순 이진 검색
- 없을때값 지정: `=XLOOKUP(A1, B:B, C:C, "찾을 수 없음")` — #N/A 대신 사용자 메시지 반환
- 와일드카드 검색: `=XLOOKUP("*서울*", A:A, B:B, , 2)` — 일치모드 2 필수
- 다중 열 반환: `=XLOOKUP(A1, ID범위, 이름:부서)` — 반환범위를 여러 열로 지정하면 여러 값 동시 반환
- 역방향 조회: `=XLOOKUP(A1, C:C, A:A)` — VLOOKUP과 달리 왼쪽 열 조회 가능
- 중첩 XLOOKUP (2차원 조회): `=XLOOKUP(행값, 행범위, XLOOKUP(열값, 열범위, 데이터범위))` — 행과 열 동시 매칭

## INDEX + MATCH 조합
- 기본 구문: `=INDEX(반환범위, MATCH(검색값, 검색범위, 일치유형))`
- MATCH 일치유형: `0` 정확히 일치, `1` 이하 최대값(오름차순 정렬 필요), `-1` 이상 최소값(내림차순 정렬 필요)
- 2차원 조회: `=INDEX(데이터범위, MATCH(행값, 행범위, 0), MATCH(열값, 열범위, 0))`
- 예: `=INDEX(B2:E100, MATCH("홍길동", A2:A100, 0), MATCH("급여", B1:E1, 0))` — 이름으로 행, 항목으로 열 매칭
- 다중 조건 조회: `=INDEX(D:D, MATCH(1, (A:A=조건1)*(B:B=조건2), 0))` — Ctrl+Shift+Enter 또는 동적 배열

## VLOOKUP vs XLOOKUP vs INDEX/MATCH 비교
- VLOOKUP: 첫 열 기준 오른쪽만 조회, 열 삽입 시 열번호 깨짐, 정확히/근사 일치만 지원
- XLOOKUP: 양방향 조회, 없을때값 기본 제공, 와일드카드/이진 검색 지원, Microsoft 365 전용
- INDEX/MATCH: 양방향 조회, 모든 Excel 버전 호환, 열 삽입에 안전, 2차원 조회 가능
- 권장: Microsoft 365 환경이면 XLOOKUP, 호환성이 중요하면 INDEX/MATCH 사용

## 중첩 IF vs IFS vs SWITCH 비교
- 중첩 IF: `=IF(점수>=90,"A",IF(점수>=80,"B",IF(점수>=70,"C","D")))` — 최대 64단계, 가독성 낮음
- IFS (Excel 2019+): `=IFS(점수>=90,"A", 점수>=80,"B", 점수>=70,"C", TRUE,"D")` — 조건 순서대로 평가, TRUE로 기본값
- SWITCH: `=SWITCH(등급, "A",4.0, "B",3.0, "C",2.0, 0)` — 정확한 값 매칭에 적합, 마지막 인수가 기본값
- 선택 기준: 범위 조건 → IFS, 값 매칭 → SWITCH, 호환성 → 중첩 IF

## SUMPRODUCT 고급 활용
- 기본: `=SUMPRODUCT(수량범위, 단가범위)` — 각 행의 수량×단가를 모두 합산
- 조건부 집계: `=SUMPRODUCT((부서="영업")*(매출범위))` — 조건을 0/1로 변환하여 곱셈
- 다중 조건: `=SUMPRODUCT((부서="영업")*(월="1월")*(매출범위))` — AND 조건은 곱셈
- OR 조건: `=SUMPRODUCT(((부서="영업")+(부서="마케팅"))*(매출범위))` — OR은 덧셈 (중복 주의)
- 가중 평균: `=SUMPRODUCT(점수범위, 가중치범위)/SUM(가중치범위)`
- 고유 개수: `=SUMPRODUCT(1/COUNTIF(범위, 범위))` — 중복 제거 후 개수 (빈 셀 없을 때)
- COUNTIF 대체: `=SUMPRODUCT((조건1)*(조건2))` — TRUE를 1로 변환하여 개수 세기

## 배열 수식: CSE vs 동적 배열
- CSE(레거시): Ctrl+Shift+Enter로 확정, 수식 표시줄에 `{}`표시, 출력 크기 미리 선택 필요
- 동적 배열 (Microsoft 365): Enter만으로 자동 확장(스필), 인접 셀 비어있어야 함
- 스필 참조: `=A1#` — A1에서 시작하는 동적 배열의 전체 결과 참조
- 암시적 교차: `@` 연산자 — 동적 배열에서 단일 값만 반환 `=@SORT(A1:A10)`
- FILTER: `=FILTER(A1:C100, B1:B100>1000, "없음")` — 조건에 맞는 행만 추출
- SORT: `=SORT(A1:C100, 2, -1)` — 2번째 열 기준 내림차순 정렬
- SORTBY: `=SORTBY(A1:C100, D1:D100, 1)` — 외부 열 기준 정렬
- UNIQUE: `=UNIQUE(A1:A100)` — 중복 제거 목록 반환

## LET 함수
- 구문: `=LET(변수1, 값1, 변수2, 값2, ..., 계산식)`
- 중간 결과를 변수로 저장하여 수식 가독성 향상 및 반복 계산 방지
- 예시: `=LET(세전, B2*C2, 세금, 세전*0.1, 세전-세금)` — 세전 금액 계산 후 세금 차감
- 복잡한 예: `=LET(필터결과, FILTER(매출,부서="영업"), 합계, SUM(필터결과), 건수, ROWS(필터결과), 합계/건수)` — 영업부 평균 매출
- 중첩 수식 리팩토링: 같은 계산이 2번 이상 반복되면 LET으로 변수화

## LAMBDA 함수
- 구문: `=LAMBDA(매개변수1, 매개변수2, ..., 수식)(인수1, 인수2)`
- 이름 관리자에 등록하면 사용자 정의 함수처럼 사용 가능
- 등록 방법: 수식 탭 → 이름 관리자 → 새로 만들기 → 이름에 함수명, 참조 대상에 LAMBDA 수식 입력
- 예: 이름 `부가세계산`, 참조 대상 `=LAMBDA(금액, 세율, 금액*세율)` → 셀에서 `=부가세계산(10000, 0.1)` 사용
- 재귀 LAMBDA: 이름 관리자에 등록 후 자기 자신을 호출 가능 (반복 처리에 활용)

## MAP, REDUCE, SCAN 함수
- MAP: `=MAP(배열, LAMBDA(x, 수식))` — 배열 각 요소에 함수 적용, 결과 배열 반환
- 예: `=MAP(A1:A10, LAMBDA(x, IF(x>0, "양수", "음수")))` — 각 셀 판정
- REDUCE: `=REDUCE(초기값, 배열, LAMBDA(누적, 현재, 수식))` — 배열을 단일 값으로 축소
- 예: `=REDUCE(0, A1:A10, LAMBDA(acc, x, acc+x^2))` — 제곱합 계산
- SCAN: `=SCAN(초기값, 배열, LAMBDA(누적, 현재, 수식))` — REDUCE와 같지만 중간 결과 배열 반환
- 예: `=SCAN(0, A1:A10, LAMBDA(acc, x, acc+x))` — 누적 합계 배열

## BYROW, BYCOL 함수
- BYROW: `=BYROW(범위, LAMBDA(행, 수식))` — 각 행에 함수 적용
- 예: `=BYROW(A1:C10, LAMBDA(r, MAX(r)-MIN(r)))` — 행별 범위(최대-최소) 계산
- BYCOL: `=BYCOL(범위, LAMBDA(열, 수식))` — 각 열에 함수 적용
- 예: `=BYCOL(A1:C10, LAMBDA(c, AVERAGE(c)))` — 열별 평균 계산
- LAMBDA 조합: BYROW/BYCOL 내부에서 복잡한 LAMBDA 로직 구현 가능

## INDIRECT, ADDRESS 함수
- INDIRECT: `=INDIRECT(텍스트참조)` — 문자열을 셀 참조로 변환
- 예: `=INDIRECT("A"&B1)` — B1이 5이면 A5 셀 참조
- 다른 시트 참조: `=INDIRECT("'"&시트명&"'!A1")` — 시트명을 동적으로 지정
- ADDRESS: `=ADDRESS(행번호, 열번호, [참조유형])` — 행/열 번호로 셀 주소 텍스트 생성
- 참조유형: `1` 절대($A$1), `2` 행절대(A$1), `3` 열절대($A1), `4` 상대(A1)
- 조합: `=INDIRECT(ADDRESS(ROW(), MATCH("급여",1:1,0)))` — 열 이름으로 동적 참조
- 주의: INDIRECT는 휘발성 함수로 대량 사용 시 성능 저하, 문자열 기반이라 시트명 변경 시 자동 업데이트 안 됨

## TEXT 함수 형식 코드
- 구문: `=TEXT(값, 형식코드)`
- 날짜 형식: `"YYYY-MM-DD"` → 2024-03-15, `"YYYY년 M월 D일"` → 2024년 3월 15일
- 요일: `"DDDD"` → 금요일, `"DDD"` → 금, `"AAAA"` → 금요일 (한국어)
- 시간: `"HH:MM:SS"` → 14:30:00, `"H시 M분"` → 14시 30분, `"AM/PM h:mm"` → PM 2:30
- 숫자 천단위: `"#,##0"` → 1,234,567, `"#,##0.00"` → 1,234,567.89
- 백분율: `"0.0%"` → 85.3%, `"0%"` → 85%
- 선행 0: `"000"` → 007, `"0000"` → 0042
- 양수/음수/0 구분: `"#,##0;[RED]-#,##0;0"` — 양수는 기본, 음수는 빨간색, 0은 0
- 단위 포함: `"#,##0\"원\""` → 1,234원, `"$#,##0"` → $1,234
- 조합 예: `=TEXT(TODAY(),"YYYY년 MM월 DD일 (DDD)")` → 2024년 03월 15일 (금)
